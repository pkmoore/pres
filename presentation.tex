\documentclass[pdf]{beamer}
\usepackage{pifont}
\mode<presentation>{}
\title{Identifying Environment Related Faults with CrashSimulator}
\subtitle{The Subtitle}
\author{Preston Moore}
\begin{document}


\begin{frame}
  \titlepage{}
\end{frame}


\begin{frame}{Environments}
  \begin{itemize}
  \item{Programs do not execute in isolation}
  \item{Instead, they operate:}
    \begin{itemize}
    \item{On the inputs they are provided}
    \item{\textit{In the context of the environment they are executing in}}
    \item{We are really good at testing by manipulating inputs!}
    \end{itemize}
  \end{itemize}
\end{frame}


\begin{frame}{What is an Environment?}
  \begin{itemize}
  \item{An application's environment provides:}
  \item{An implicit input in the form of environment variables, file
      contents, and other data accessible by the application}
  \item{An implementation of executable resources an application depends upon}
    \begin{itemize}
    \item{e.g. libraries, callable OS functions}
    \end{itemize}
\end{itemize}
\end{frame}


\begin{frame}{How Can Environments Differ}
  \begin{itemize}
  \item{Differing versions of libraries and software dependences}
  \item{Condition of the network on which the application relies}
  \item{Operating system states, which can vary}
    \begin{itemize}
    \item{\textit{e.g.\ filesystem state, environment variable values}}
    \end{itemize}
  \end{itemize}
\end{frame}


\begin{frame}{Environmental Variations Can Reveal Bugs!}
  \begin{itemize}
  \item{An application may fail if it doesn't handle a file it needs being missing}
  \item{An application may fail if it doesn't handle unusual filesystem configurations}
  \item{An application may fail if it doesn't handle possible network
      performance issues}
  \item{Failure to deal with these conditions results in incorrect behavior ---
      i.e.\ bugs}
  \item{These bugs are hard to find because setting up different environments is
      expensive}
  %\item{Weird environmental conditions may be uncommon so developers do not
  %    know that they need to handle them!}
  \end{itemize}
\end{frame}


\begin{frame}{The Typical Scenario}
  \begin{itemize}
  \item{Applications are tested under ideal conditions}
  \item{These bugs do not present themselves until an application has
      been deployed to some other environment}
  \item{Bugs must be diagnosed, fixes must be created, and distributed}
  \item{What is needed is a way to test how applications reactions to particular
      environmental conditions \textbf{BEFORE} they are deployed}
  \end{itemize}
\end{frame}


\begin{frame}{CrashSimulator}
  \begin{itemize}
  \item{CrashSimulator is a set of techniques and a tool for:}
    \begin{itemize}
    \item{Generically capturing and encoding unusual environmental conditions}
    \item{Injecting these conditions into an execution of an application under
        test}
    \item{Making an assessment about whether the application handled the
        weird behavior correctly or not}
    \end{itemize}
  \end{itemize}
\end{frame}


\begin{frame}{The Key Idea}
  \begin{itemize}
  \item{In a modern setup, an application interacts with its environment
      through the operating system through system calls}
  \item{The results of these system calls represent weird environmental conditions}
  \item{e.g. Poor network performance may involve network-related system
      calls timing out, filesystem issues may result in filesystem-related system
      calls failing or returning weird results}
  \end{itemize}
\end{frame}


\begin{frame}{The Process}
  \begin{itemize}
  \item{Record system call trace of application running in anomalous
      environment}
  \item{Analyze the trace to identify system call results are
      indicative of the environment's anomalous conditions}
  \item{Inject the results into an execution of the application being tested}
  \item{Assess how the application responds}
  \end{itemize}
\end{frame}


\begin{frame}{Injecting Anomalous System Call Results into an Execution}
  \begin{itemize}
  \item{Record trace of application under test}
  \item{Perturb trace so it now contains anomalous system call results}
    \begin{itemize}
    \item{Some mutations can be done programmatically}
    \item{Some mutations require manual effort (at this time)}
    \end{itemize}
  \item{Replay execution of application using mutated trace}
  \end{itemize}
\end{frame}


\begin{frame}{An Example}
  ...
\end{frame}


\begin{frame}{Replaying a System Call: The Ideal Case}
  \begin{itemize}
  \item{Intercept the system call and handle its effects
      ourselves}
    \begin{itemize}
    \item{All ``simple'' system calls}
    \item{All system calls involving file descriptors that do not really exist}
      \begin{itemize}
      \item{That is, file descriptors produced from system calls that we
          previously intercepted and handled}
      \end{itemize}
    \end{itemize}
  \item{Convert system call into a call to getpid()}
  \item{Parse corresponding line from system call trace}
  \item{Update register values and memory contents to reflect the results we
      \textbf{parsed out of the trace}}
  \end{itemize}
\end{frame}


\begin{frame}{Replaying a System Call: When That Does Not Work}
  \begin{itemize}
  \item{The effects of some system calls are too complex to deal with}
    \begin{itemize}
    \item{e.g.\ mmap()}
    \end{itemize}
  \item{In this case we allow them to be executed natively by:}
    \begin{itemize}
      \item{Instructing ptrace to allow the application to execute until the
          next system call}
      \item{Checking upcoming system call to ensure it matches the corresponding
          line from the trace being replayed}
      \item{Restarting execution of the application thereby allowing it to
          actually make a real system call}
      \item{Checking the results to ensure they too match the results from the
          corresponding line in the trace being replayed}
    \end{itemize}
  \end{itemize}
\end{frame}


\begin{frame}{Replaying a System Call Trace}
  \begin{itemize}
  \item{Execute application}
  \item{Use Linux's Ptrace facilities to interrupt execution at every system
      call}
  \item{Adjust program state to match contents of system call trace}
  \item{Because replay process ensures system calls respond the same way as they
      did when the trace was recorded, the application will follow the same
      execution}
  \end{itemize}
\end{frame}


\begin{frame}{Assessing the Response of an Application}
  \begin{itemize}
  \item{If an application changes its system call behavior the replay diverges,
      i.e. execution no longer matches the trace}
  \item{This means the application may be trying to handle the anomalous behavior}
    \begin{itemize}
    \item{\textit{Possibly correct behavior}}
    \end{itemize}
  \item{If an application does not change its system call behavior, replay
      continues}
    \begin{itemize}
    \item{\textit{Application has not made an effort to handle anomalous conditions}}
    \end{itemize}
  \end{itemize}
\end{frame}


\begin{frame}{Proof of Concept Implementation}
  \begin{itemize}
  \item{Implementation on 32-bit Linux}
  \item{Python Orchestration: Keep Trace and Execution in Sync}
  \item{C Interface: Ptrace and Structuring Data}
  \end{itemize}
\end{frame}


\begin{frame}{Anomalies Used}
  \begin{itemize}
  \item{Unexpected Linux File Types}
  \item{Cross-disk File Movement}
  \item{Extremely Long Network Timeouts}
  \end{itemize}
\end{frame}


\begin{frame}{Unexpected Linux File Types}
  \begin{itemize}
  \item{Linux provides different types of files with different capabilities}
  \item{Application should confirm file type before processing a file}
  \item{Otherwise, problems:}
    \begin{itemize}
    \item{Applications hang on FIFOs files}
    \item{Applications consume disk space/memory/etc. processing ``infinitely
        large'' files}
    \end{itemize}
  \item{Found bugs in coreutils utilities and gnupg}
  \end{itemize}
\end{frame}


\begin{frame}{Unusual File Type Bugs}
  \tiny{}
    \begin{tabular}[H]{l  l  |  l  l  l  l  l  l  l}
        Application & Condition Tested           & IFREG        & IFDIR        & IFCHR     & IFBLK    & FIFO      & IFLNK    & IFSOCK\\
\hline
        Aspell      & Dictionary File            & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        Aspell      & File being checked         & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        gnu-gpg     & secring.gpg                & \ding{104}  & \ding{55}  & \ding{55}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        vim         & File being opened          & \ding{104}  & \ding{51}  & \ding{51}  & \ding{51} & \ding{51} & \ding{51} & \ding{55}\\
        nano        & File being opened          & \ding{104}  & \ding{51}  & \ding{51}  & \ding{51} & \ding{55} & \ding{55} & \ding{55}\\
        sed         & File being edited          & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        df          & /proc                      & \ding{55}   & \ding{104} & \ding{55}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        wc          & File being checked         & \ding{104}  & \ding{51}  & \ding{51}  & \ding{51} & \ding{51} & \ding{51} & \ding{51}\\
        du          & Directory being checked    & \ding{51}   & \ding{104} & \ding{51}  & \ding{51} & \ding{51} & \ding{51} & \ding{51}\\
        install     & File being installed       & \ding{104}  & \ding{51}  & \ding{55}  & \ding{55} & \ding{55} & \ding{51} & \ding{55}\\
        fmt         & File being formatted       & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        od          & File being dumped          & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        ptx         & File being read            & \ding{104}  & \ding{51}  & \ding{51}  & \ding{51} & \ding{51} & \ding{51} & \ding{51}\\
        comm        & Second file being          & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        pr          & File being read            & \ding{104}  & \ding{55}  & \ding{55}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
\hline
        readlink    & Link being evaluated       & \textbf{N/A} & & & & & & \\
        unlink      & File being unlinked        & \textbf{N/A} & & & & & & \\
    \end{tabular}
    \begin{itemize}
    \item{\ding{104} --- Unmodified value}
    \item{\ding{55} --- Application fails to recognize condition}
    \item{\ding{51} --- Application recognizes condition}
    \end{itemize}
\end{frame}


\begin{frame}{Cross-Disk File Movement Discussion}
  \begin{itemize}
  \item{Moving a file around on the same disk is trivial: rename() system
      call}
  \item{This system call does not support moving a file from one disk to
      another}
  \item{An application must detect this situation and either fail
      gracefully or perform the file move ``manually''}
  \item{Otherwise, problems:}
    \begin{itemize}
    \item{Loss of file contents}
    \item{Loss of file metadata}
    \item{Race conditions}
    \item{Filling of disk space}
    \end{itemize}
  \item{Race condition in Python's shutil}
  \item{Loss of extended file attributes in Rust's std::fs}
  \item{Fill disk space bug in C++'s Boost::filesystem}
  \end{itemize}
\end{frame}


\begin{frame}{Cross-Disk File Movement Results}
Put table in here
\end{frame}


\begin{frame}{Extremely Long Network Timeouts Discussion}
  \begin{itemize}
  \item{Applications that do not configure reasonable timeouts are vulnerable
      to a malicious communication participant dragging communication out over a
      long period of time}
  \item{This process ties up resources and greatly lowers the effort required to
      consume all available resources preventing legitimate access}
  \item{``Slowloris'' Denial of Service attack against http servers}
    \begin{itemize}
    \item{involved keeping a connection open to a vulnerable server by
        introducing just-below-the-timeout delays between sending HTTP headers}
        \end{itemize}
  \item{MANY Python HTTP/HTTPS/web modules vulnerable}
  \end{itemize}
\end{frame}


\begin{frame}{Extremely Long Network Timeouts Results}
Put table here
\end{frame}


\begin{frame}{Conclusions}
Write a conclusion
\end{frame}
     

\end{document}
