\documentclass[pdf]{beamer}
\usepackage{pifont}
\mode<presentation>{}
\title{Quals Presentation}
\subtitle{The Subtitle}
\author{Preston Moore}
\begin{document}


\begin{frame}
  \titlepage{}
\end{frame}


\begin{frame}{Environments}
  \begin{itemize}
  \item{Programs don't execute in isolation}
  \item{They operate on the inputs they are provided}
    \begin{itemize}
    \item{\textit{We are really good at testing by manipulating inputs!}}
    \end{itemize}
  \item{\textit{In the context of the environment they are executing in}}
  \end{itemize}
\end{frame}


\begin{frame}{How Can Environments Differ}
  \begin{itemize}
  \item{Hardware the application is running on}
  \item{Conditions on the network the application relies on}
  \item{Differing versions of libraries and software dependences}
  \item{Differences in Operating System State}
    \begin{itemize}
    \item{\textit{e.g.\ filesystem state}}
    \end{itemize}
  \end{itemize}
\end{frame}


\begin{frame}{Different Environments Reveal Different Bugs!}
  % Define the term environmental bugs here
  \begin{itemize}
  \item{An application may fail if a file it depends on isn't present}
  \item{An application may fail if the filesystem isn't configured as
      expected}
  \item{An application may fail if the network performs differently than expected}
  \item{These bugs are hard to find because setting up different environments is
      expensive}
  \item{Weird environmental conditions may be uncommon so developers don't
      know that they need to handle them!}
  \end{itemize}
\end{frame}


\begin{frame}{The Cost!}
  \begin{itemize}
  \item{Applications are often tested under ideal conditions}
  \item{These bugs often will not present themselves until an application has
      been deployed to the weird environment in question}
  \item{What is needed is a way to test how applications will respond when they
      encounter weird environmental conditions \textbf{BEFORE} they make it to
      go through a real world deployment}
  \end{itemize}
\end{frame}


\begin{frame}{CrashSimulator}
  \begin{itemize}
  \item{CrashSimulator is a set of techniques and a tool for:}
    \begin{itemize}
    \item{Generically capturing and encoding weird environmental conditions}
    \item{Injecting these conditions into an execution of an application under
        test}
    \item{Making an assessment about whether the application handled the
        weird behavior correctly or not}
    \end{itemize}
  \end{itemize}
\end{frame}


\begin{frame}{The Key Idea}
  \begin{itemize}
  \item{In a modern setup, an application interacts with its environment
      through the operating system}
  \item{This is accomplished through system calls}
  \item{The results of these system calls represent weird environmental conditions}
  \item{e.g. Poor network performance may involve network-related system
      calls timing out}
  \item{Weird filesystem issue may result in filesystem-related system
      calls failing or returning weird results}
  \end{itemize}
\end{frame}


\begin{frame}{The Process}
  \begin{itemize}
  \item{Record system call trace of application running in anomalous
      environment}
  \item{Analyze system call trace to identify system call results are
      indicative of the anomalous conditions}
  \item{Influence execution of application under test such that it experiences
      the identified anomalous system call results}
  \end{itemize}
\end{frame}


\begin{frame}{Injecting Behavior into an Execution}
  \begin{itemize}
  \item{Record trace of application under test}
  \item{Perturb trace so it now contains anomalous system call results}
    \begin{itemize}
    \item{Some mutations can be done programmatically}
    \item{Some mutations require manual effort (at this time)}
    \end{itemize}
  \item{Replay execution of application using mutated trace}
  \end{itemize}
\end{frame}


\begin{frame}{An Example}
  ...
\end{frame}


\begin{frame}{Replaying a System Call: The Ideal Case}
  \begin{itemize}
  \item{Intercept the system call and handle its effects
      ourselves}
    \begin{itemize}
    \item{All ``simple'' system calls}
    \item{All system calls involving file descriptors that don't really exist}
      \begin{itemize}
      \item{That is, file descriptors produced from system calls that we
          previously intercepted and handled}
      \end{itemize}
    \end{itemize}
  \item{Convert system call into a call to getpid()}
  \item{Parse corresponding line from system call trace}
  \item{Update register values and memory contents to reflect the results we
      \textbf{parsed out of the trace}}
  \end{itemize}
\end{frame}


\begin{frame}{Replaying a System Call: When That Doesn't Work}
  \begin{itemize}
  \item{The effects of some system calls are too complex to deal with}
    \begin{itemize}
    \item{e.g.\ mmap()}
    \end{itemize}
  \item{In this case we allow them to be executed natively}
  \end{itemize}
\end{frame}


\begin{frame}{Replaying a System Call Trace}
  \begin{itemize}
  \item{Execute application}
  \item{Use Linux's Ptrace facilities to interrupt execution at every system
      call in order to perform the previous steps}
  \item{Because replay process ensures system calls respond the same way as they
      did when the trace was recorded, the application will follow the same
      execution}
  \end{itemize}
\end{frame}


\begin{frame}{Assessing Application's Response}
  \begin{itemize}
  \item{If an application changes its system call behavior, replay diverges it may
      be trying to handle the anomalous behavior}
    \begin{itemize}
    \item{\textit{possibly correct behavior}}
    \end{itemize}
  \item{If an application does not change its system call behavior, replay
      continues}
    \begin{itemize}
    \item{\textit{Application has not made an effort to handle anomalous conditions}}
    \end{itemize}
  \end{itemize}
\end{frame}


\begin{frame}{PoC Implementation}
  \begin{itemize}
  \item{Implementation on 32-bit Linux}
  \item{Python Orchestration: Keep Trace and Execution in Sync}
  \item{C Interface: Ptrace and Structuring Data}
  \end{itemize}
\end{frame}


\begin{frame}{Anomalies Used}
  \begin{itemize}
  \item{Unexpected Linux File Types}
  \item{Cross-disk File Movement}
  \item{Extremely Long Network Timeouts}
  \end{itemize}
\end{frame}


\begin{frame}{Unexpected Linux File Types}
  \begin{itemize}
  \item{Linux provides different types of files with different capabilities}
  \item{Application should confirm file type before processing a file}
  \item{Otherwise, problems:}
    \begin{itemize}
    \item{Applications hang on FIFOs files}
    \item{Applications consume disk space/memory/etc. processing ``infinitely
        large'' files}
    \end{itemize}
  \item{Found bugs in coreutils utilities and gnupg}
  \end{itemize}
\end{frame}


\begin{frame}{Unusual File Type Bugs}
  \tiny{}
    \begin{tabular}[H]{l  l  |  l  l  l  l  l  l  l}
        Application & Condition Tested           & IFREG        & IFDIR        & IFCHR     & IFBLK    & FIFO      & IFLNK    & IFSOCK\\
\hline
        Aspell      & Dictionary File            & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        Aspell      & File being checked         & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        gnu-gpg     & secring.gpg                & \ding{104}  & \ding{55}  & \ding{55}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        vim         & File being opened          & \ding{104}  & \ding{51}  & \ding{51}  & \ding{51} & \ding{51} & \ding{51} & \ding{55}\\
        nano        & File being opened          & \ding{104}  & \ding{51}  & \ding{51}  & \ding{51} & \ding{55} & \ding{55} & \ding{55}\\
        sed         & File being edited          & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        df          & /proc                      & \ding{55}   & \ding{104} & \ding{55}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        wc          & File being checked         & \ding{104}  & \ding{51}  & \ding{51}  & \ding{51} & \ding{51} & \ding{51} & \ding{51}\\
        du          & Directory being checked    & \ding{51}   & \ding{104} & \ding{51}  & \ding{51} & \ding{51} & \ding{51} & \ding{51}\\
        install     & File being installed       & \ding{104}  & \ding{51}  & \ding{55}  & \ding{55} & \ding{55} & \ding{51} & \ding{55}\\
        fmt         & File being formatted       & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        od          & File being dumped          & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        ptx         & File being read            & \ding{104}  & \ding{51}  & \ding{51}  & \ding{51} & \ding{51} & \ding{51} & \ding{51}\\
        comm        & Second file being          & \ding{104}  & \ding{55}  & \ding{51}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
        pr          & File being read            & \ding{104}  & \ding{55}  & \ding{55}  & \ding{55} & \ding{55} & \ding{55} & \ding{55}\\
\hline
        readlink    & Link being evaluated       & \textbf{N/A} & & & & & & \\
        unlink      & File being unlinked        & \textbf{N/A} & & & & & & \\
    \end{tabular}
\end{frame}


\begin{frame}{Cross-Disk File Movement}
  \begin{itemize}
  \item{Moving a file around on the same disk is trivial: rename() system
      call}
  \item{This system call does not support moving a file from one disk to
      another}
  \item{An application must detect this situation and either fail
      gracefully or perform the file move ``manually''}
  \item{Otherwise, problems:}
    \begin{itemize}
    \item{Loss of file contents}
    \item{Loss of file metadata}
    \item{Race conditions}
    \item{Filling of disk space}
    \end{itemize}
  \end{itemize}
\item{Race condition in Python's shutil}
\item{Loss of extended file attributes in Rust's std::fs}
\item{Fill disk space bug in C++'s Boost::filesystem}
\end{frame}


\begin{frame}{Cross-Disk Move Bugs}
Put table in here
\end{frame}


\begin{frame}{Extremely Long Network Timeouts}
  \item{
  Discuss applications with outrageous timeouts
  Describe situation where this could be bad
  \item{Slowloris attack against web servers}
\end{frame}


\begin{frame}{Conclusions}
Write a conclusion
\end{frame}
     

\end{document}
